# 마피아 게임 🕵️‍♂️👩‍⚕️🚓
마피아 게임은 플레이어들이 마피아, 의사, 경찰 등의 역할을 맡아 서로의 정체를 추리하며 플레이하는 게임입니다.
마피아 게임을 하면서 예상치 못한 트롤링 등이나 비이성적인 행동을 나타내고자 가중치라는 개념을 추가하여 AI Player 들의 경우 랜덤적인 요소를 갖도록 하였습니다.

## 시작하기 🚀
이 프로젝트를 클론한 뒤 단일 파이썬 파일로 되어있기 때문에 사용하는데 어려움은 없으리라 생각됩니다.
본인의 OPENAI의 API 키를 입력한 다음 터미널에서 아래와 같이 실행하시면 됩니다.
```
python3 mafia_game.py 
```

## 코드 구조 🏗️
### 클래스
- Player: 플레이어를 나타내는 기본 클래스입니다. 이름, 생존 여부, 역할 등의 속성을 가집니다.
- HumanPlayer: 사람이 플레이하는 경우의 클래스입니다. Player 클래스를 상속받습니다.
- MafiaGame: 마피아 게임의 메인 클래스입니다. 게임 진행과 관련된 기능을 포함하며, 역할 할당, GPT에 메시지 추가 등의 메서드를 가집니다.
### 주요 메서드
- assign_roles(): 게임 시작 시 플레이어에게 역할을 무작위로 할당합니다.
- get_weighted_choice(player, prompt): 플레이어가 주어진 메시지를 보고 가중치를 부여하여 선택을 하도록 합니다.
- mafia_kill(): 마피아가 죽일 플레이어를 선택하는 과정을 진행합니다.
- doctor_save(): 의사가 치료할 플레이어를 선택하는 과정을 진행합니다.
- police_investigate(): 경찰이 조사할 플레이어를 선택하는 과정을 진행합니다.


## 게임 실행 결과
아직 몇몇 오류는 잡아야하지만 아래의 결과만으로도 생각보다 흥미진진합니다. 처음부터 저를 공격하는 나연님도 있고 2 대화내용을 바탕으로 저를 옹호하는 대화도 보이네요. 
```
당신의 이름을 입력하세요:대형
플레이어 나연 생성중...
플레이어 정연 생성중...
플레이어 사나 생성중...
플레이어 미나 생성중...
플레이어 모모 생성중...
플레이어 대형 생성중...
마피아 1명을 뽑는중...
경찰 1명을 뽑는중...
의사 1명을 뽑는중...
당신은 의사입니다. 밤이되면 한 명을 지목하여 치료할 수 있습니다. 이때 자기자신을 선택할수도 있습니다. 마피아가 죽일만한 시민을 선택하여 치료하세요.: 네
=========================================
낮이 되었습니다.  <1일차> 
생존자: [나연, 정연, 사나, 미나, 모모, 대형] 
낮 시간동안 자유롭게 대화를 나눠주세요.
=========================================
나연님, 발언해주세요.
저는 첫 낮부터 고민이 되는 행동을 했던 사람이 있습니다. 그 사람은 "대형"님입니다. 대형님이 게임을
시작하자마자 마피아가 반드시 2명이라는 주장을 했는데요. 이런 고지식한 생각으로 마피아를 발견하기는 쉽지 않습니다. 저는 대형님을 검은색 리스트에 넣겠습니다.
-------------------------------------
정연님, 발언해주세요.
저는 아직 마피아가 누구인지 몰라서 말씀드리기 어렵지만, 게임을 시작하면서 가장 첫글자를 출력한 사람
중 한분이 마피아일 가능성이 있습니다. 물론 이것이 100% 확실한 것은 아니지만, 여러 참가자 중에 
처음 말을 올린 사람이 마피아일 가능성이 있으니 조심해야 한다는 것을 알리고 싶습니다. 그 외에도, 
오늘 하루 내내 참가자 분들과 대화를 하면서 역할과 정보를 내놓는 것이 중요하다고 생각합니다.
-------------------------------------
사나님, 발언해주세요.
저는 지금 당장은 마피아가 누구인지 모르겠습니다. 하지만 정연님 말씀처럼 게임을 시작할 때 처음에
말을 한 사람이 마피아일 가능성이 있다는 것을 염두에 둬야 한다는 것에 동의합니다. 저는 오늘 하루 내내 여러분들과 대화를 나누면서 정보를 수집하고 추론해보겠습니다.
-------------------------------------
미나님, 발언해주세요.
처음부터 게임을 시작한 대형님의 발언이 마피아가 2명이라는 것입니다. 첫 플레이어가 마피아가 
될 가능성이 있다는 것에 대해서는 동의합니다. 하지만 이후 대형님은 대화에 참여하지 않으시고 묵묵히 지켜보는 것 같습니다. 그래서 한번 대형님을 투표로 지목하는 것도 좋을 것 같습니다.
-------------------------------------
모모님, 발언해주세요.
저는 지금까지 다른 분들의 말씀을 잘 들어보았습니다. 저 역시 게임을 시작하는 순간부터 
여러 참가자분들의 행동을 주의깊게 지켜보고 있습니다. 마피아를 찾기 위해서는 토론에서 
흘러나오는 모든 정보들을 잘 비교하고 조합해야 한다고 생각합니다. 오늘 하루도 열심히 살아남기 위해 노력하겠습니다.
-------------------------------------
대형님, 발언해주세요.
당신의 발언차례입니다. 자유롭게 의견을 말해주세요.: 저는 선량 시민이고 직업은 의사임을 밝힙니다. 
저는 마피아가 2명이라는 발언을 한 적이 없으면 이것은 나연님이 저를 마피아로 몰아가려는 수작으로 보입니다. 
그리고 당연히 저의 발언 차례가 아니기에 조용히 있었습니다. 저는 말을 많이하는 나연님이 매우 의심스럽습니다.
시민이고 직업은 의사임을 밝힙니다. 저는 마피아가 2명이라는 발언을 한 적이 없으면 
이것은 나연님이 저를 마피아로 몰아가려는 수작으로 보입니다. 그리고 당연히 저의 발언 차례가 아니기에 조용히 있었습니다. 저는 말을 많이하는 나연님이 매우 의심스럽습니다.
-------------------------------------
>>> 투표를 시작합니다
나연님, 누구에게 투표하시겠습니까?
정연: 0표
사나: 0표
미나: 0표
모모: 0표
대형: 0표
나연님은 정연님에게 투표했습니다.
정연님, 누구에게 투표하시겠습니까?
나연: 0표
사나: 0표
미나: 0표
모모: 0표
대형: 0표
정연님은 모모님에게 투표했습니다.
사나님, 누구에게 투표하시겠습니까?
나연: 0표
정연: 1표
미나: 0표
모모: 1표
대형: 0표
사나님은 모모님에게 투표했습니다.
미나님, 누구에게 투표하시겠습니까?
나연: 0표
정연: 1표
사나: 0표
모모: 2표
대형: 0표
미나님은 사나님에게 투표했습니다.
모모님, 누구에게 투표하시겠습니까?
나연: 0표
정연: 1표
사나: 1표
미나: 0표
대형: 0표
모모님은 미나님에게 투표했습니다.
대형님, 누구에게 투표하시겠습니까?
나연: 0표
정연: 1표
사나: 1표
미나: 1표
모모: 2표
다음 플레이어 목록에서 마피아로 의심되는 순서대로 가중치를 할당해주세요.
가중치 값은 정수여야 하며, 목록에 있는 플레이어 수와 일치해야 합니다. 아래 양식에 맞춰 정확한 가중치 리스트를 작성해주세요. 예: [1, 2, 3]
투표 대상: ['나연', '정연', '사나', '미나', '모모'][4,1,1,1,1]
대형님은 정연님에게 투표했습니다.
정연님이 가장 많은 표를 얻었습니다
정연님, 최후의 변론을 해주세요.
저는 시민입니다. 마을을 위해 최선을 다해서 역할을 부여받았고, 여러분들도 그렇듯 
마피아 찾기에 열심히 기여하겠습니다. 토론을 통해 추론을 하다 보면 제가 마피아가 아님을 확인하게 될 것입니다. 함께 시간을 보내며 마피아를 찾아내자고 다시 한번 말씀드립니다.
선량한 시민 정연님께서 죽었습니다.
=========================================
밤이 되었습니다.
=========================================
경찰은 조용히 일어나 한 명을 지목해주세요.
마피아는 죽일 사람을 선택해주세요.
의사는 조용히 일어나 한 명을 지목해주세요.
다음 플레이어 목록에서 마피아가 밤에 죽일것 같은 플레이어를 순서대로 가중치를 할당해주세요.       
가중치 값은 정수여야 하며, 목록에 있는 플레이어 수와 일치해야 합니다. 아래 양식에 맞춰 가중치 리스트를 작성해주세요. 예: [1, 2, 3]
투표 대상: [나연, 사나, 미나, 모모][1,5,1,1]
의사의 치료 덕분에 오늘 밤 아무도 죽지 않았습니다.
=========================================
낮이 되었습니다.  <2일차> 
생존자: [나연, 사나, 미나, 모모, 대형] 
낮 시간동안 자유롭게 대화를 나눠주세요.
=========================================
나연님, 발언해주세요.
지난 밤에는 정연님을 잃어버렸습니다. 모두들 슬퍼하시겠지만 계속해서 마피아를 찾아내는 것이 중요합니다. 
정연님의 의견과 행동을 생각해보면 어떤 힌트를 얻을 수 있을지 고민해보아야할 것 같습니다. 
이번 낮을 통해서 정말 마피아라고 생각되는 사람을 찾아내서 반드시 처리해야 합니다.
-------------------------------------
사나님, 발언해주세요.
저는 지난날 발언으로부터, 모든 생존자 들의 발언에서 마피아를 찾아내야 한다는 것에 공감하는 중입니다.
그러나, 발언을 할 때 최소한의 근거를 가지고 발언하는 것이 중요합니다. 
없던 근거로 발언한 나연님의 첫날 발언은 독이 될 수 있습니다. 
이번 낮의 발언에서는 서로의 발언 내용을 중심으로 논의를 하면서, 조금 더 구체적인 정보를 제시해서, 충분한 증거를 통해 찾아내는 것이 중요하다고 생각합니다.
-------------------------------------
미나님, 발언해주세요.
모든 생존자들은 이번 낮을 통해 마피아를 찾아낼 수 있다는 것에 동의합니다. 
하지만, 단순한 추측이나 앞뒤가 맞지 않는 정보로 마피아로 지목하는 것은 오히려 마을을 분열시키고 원래 있던 마피아를 더욱 숨겨버릴 수 있습니다. 
모든 발언에는 근거와 함께 언급해주셨으면 좋겠습니다. 또한, 지난 밤의 사건에서 찾을 수 있는 힌트가 있을지 다시 한번 생각해보는 것도 좋을 것 같습니다.
-------------------------------------
모모님, 발언해주세요.
저희 모두 정말 슬픈 하루가 되었습니다. 
마피아 게임에서 이전에 마피아로 지목한 대형님 그리고 사라진 정연님, 그리고 지금 게임을 진행하면서 사라질 다음 희생자가 누구일지 모릅니다.
하지만, 모두가 참여해 마피아를 찾아내야 합니다. 지금까지 발언하신 내용처럼 언급한 대로 첫날부터 나연님이 예측일 뿐 근거가 없어 마피아의 흔적이 될 수 있습니다.
그리고 게임이 마무리되기 전까지는 마피아가 누구인지 모르는 것이 충분히 벌이기 수월해지기 때문에 
저희 모두 스스로를 끝까지 관리할 필요가 있습니다. 
마피아를 찾아내기 위해, 지금 낮 시간동안 저희 모두 내적으로 추측하며 게임을 하자고 생각합니다.
-------------------------------------
대형님, 발언해주세요.
당신의 발언차례입니다. 자유롭게 의견을 말해주세요.: 저는 앞서 말씀드린 대로 의사입니다.
밤에 저는 사나님을 살렸고 저의 뛰어난 감각 덕분에 사나님을 살 릴수 있었습니다. 
즉, 대형, 사나는 선량한 시민이며 나연, 미나, 모모 님 중에서 한 분이 마피아가 아닐까 생각합니다.
저는 앞서 말씀드린 대로 의사입니다. 밤에 저는 사나님을 살렸고 저의 뛰어난 감각 덕분에 사나님을 살릴수 있었습니다. 
즉, 대형, 사나는 선량한 시민이며 연, 미나, 모모 님 중에서 한 분이 마피아가 아닐까 생각합니다.
-------------------------------------
```



